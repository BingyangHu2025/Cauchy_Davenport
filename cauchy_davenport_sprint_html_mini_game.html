<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cauchy–Davenport Sprint</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#121830; --ink:#e8ecff; --muted:#9aa4c7; --accent:#6cf; --accent2:#ffb86c; --ok:#4ade80; --warn:#f59e0b; --bad:#ef4444;
      --chip:#1b2242; --chip2:#1f254a; --ring:#0f142a; --card:#141b38; --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 800px at 20% -20%,#1b2550 0%, transparent 60%),var(--bg);color:var(--ink);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,"Helvetica Neue",Arial}
    a{color:var(--accent)}
    header{padding:18px 20px 8px;display:flex;gap:14px;align-items:center;flex-wrap:wrap}
    .title{font-weight:700;letter-spacing:.3px;font-size:20px}
    .sub{color:var(--muted);font-size:13px}
    .wrap{display:grid;grid-template-columns: 380px 1fr;gap:18px;padding:0 20px 20px}
    @media (max-width: 980px){.wrap{grid-template-columns:1fr}}
    .panel{background:linear-gradient(180deg,var(--panel),#0e1530);border:1px solid #2a3568;border-radius:16px;padding:14px;box-shadow:var(--shadow)}
    .controls{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:6px 0}
    .seg{display:inline-flex;border:1px solid #2a3568;border-radius:999px;overflow:hidden}
    .seg button{background:transparent;color:var(--ink);padding:8px 12px;border:0;cursor:pointer}
    .seg button.active{background:var(--accent);color:#0b1020;font-weight:600}
    label{font-size:13px;color:var(--muted)}
    input[type=number], select{width:100%;background:var(--card);border:1px solid #2a3568;color:var(--ink);border-radius:10px;padding:9px 10px}
    .btn{background:var(--chip);border:1px solid #2a3568;color:var(--ink);padding:9px 12px;border-radius:12px;cursor:pointer}
    .btn:hover{filter:brightness(1.1)}
    .btn.alt{background:var(--chip2)}
    .legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .dot{width:10px;height:10px;border-radius:50%}
    .A{background:#5cc7ff}
    .B{background:#ffb86c}
    .S{background:#6ee7b7}
    .canvas-wrap{background:linear-gradient(180deg,#0e1530,#0b1126);border:1px solid #2a3568;border-radius:16px;padding:12px;display:grid;place-items:center;min-height:460px;box-shadow:var(--shadow)}
    svg{max-width:100%;height:auto}
    .stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px}
    .card{background:var(--card);border:1px solid #2a3568;border-radius:14px;padding:12px}
    .big{font-size:28px;font-weight:800}
    .kpi{display:flex;justify-content:space-between;align-items:baseline}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
    .hint{font-size:13px;color:var(--muted)}
    footer{max-width:1100px;margin:14px auto 40px;background:linear-gradient(180deg,var(--panel),#0e1530);border:1px solid #2a3568;border-radius:16px;padding:16px 20px;box-shadow:var(--shadow)}
    h2{margin:8px 0 6px}
    .kbd{display:inline-block;padding:2px 8px;border:1px solid #2a3568;border-radius:999px;background:var(--chip);font-size:12px}
    .notice{margin-top:6px;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <header>
    <div class="title">Cauchy–Davenport Sprint</div>
    <div class="sub">Build sets A and B in ℤ/pℤ, watch their sumset size vs. the lower bound.</div>
  </header>

  <div class="wrap">
    <aside class="panel">
      <div class="controls">
        <div class="row" style="grid-column:1/-1">
          <div class="seg" role="tablist" aria-label="Active set">
            <button id="pickA" class="active" aria-selected="true">Edit set A</button>
            <button id="pickB" aria-selected="false">Edit set B</button>
          </div>
          <div class="legend">
            <div class="row"><span class="dot A"></span><span>A</span></div>
            <div class="row"><span class="dot B"></span><span>B</span></div>
            <div class="row"><span class="dot S"></span><span>A+B</span></div>
          </div>
        </div>
        <div>
          <label for="p">Prime p</label>
          <input id="p" type="number" min="5" step="1" value="17" />
        </div>
        <div>
          <label>&nbsp;</label>
          <div class="row">
            <button class="btn" id="applyP">Apply</button>
            <button class="btn alt" id="randomize">Randomize</button>
            <button class="btn" id="reset">Reset</button>
          </div>
        </div>
        <div style="grid-column:1/-1" class="row">
          <button class="btn" id="makeAInterval">Make A into an interval</button>
          <button class="btn" id="makeBInterval">Make B into an interval</button>
        </div>
        <div style="grid-column:1/-1" class="row hint">
          Tip: equality often occurs when A and B are intervals (or near-intervals).
        </div>
      </div>

      <div class="stats">
        <div class="card">
          <div class="kpi"><div>|A|</div><div class="big" id="sizeA">0</div></div>
          <div class="kpi"><div>|B|</div><div class="big" id="sizeB">0</div></div>
        </div>
        <div class="card">
          <div class="kpi"><div>|A+B|</div><div class="big" id="sizeS">0</div></div>
          <div class="kpi"><div>Lower bound</div><div class="big" id="lb">0</div></div>
        </div>
        <div class="card" style="grid-column:1/-1">
          <div class="kpi">
            <div>Gap = |A+B| − min(p, |A|+|B|−1)</div>
            <div class="big" id="gap">0</div>
          </div>
          <div class="notice" id="diagnosis">Try forming intervals to hit the bound.</div>
        </div>
      </div>
    </aside>

    <main class="canvas-wrap">
      <svg id="ring" viewBox="0 0 700 700" aria-label="Z mod p playground"></svg>
    </main>
  </div>

  <footer class="panel" role="contentinfo">
    <h2>Cauchy–Davenport inequality (one-paragraph brief)</h2>
    <p>
      For nonempty subsets <em>A</em>, <em>B</em> of the finite cyclic group ℤ/<em>p</em>ℤ with <em>p</em> prime, the Cauchy–Davenport inequality states
      <strong>|A + B| ≥ min(p, |A| + |B| − 1)</strong>, where A + B = { a + b (mod p) : a ∈ A, b ∈ B }.
      In many near‑extremal cases, <em>A</em> and <em>B</em> look like intervals (arithmetic progressions) modulo <em>p</em>. This game lets you experiment by toggling elements on a circle for ℤ/<em>p</em>ℤ and comparing the sumset size with the lower bound.
    </p>
    <p class="notice">Controls: Click points to toggle membership in the active set (<span class="kbd">Edit set A</span> / <span class="kbd">Edit set B</span>). Use “Make into an interval” to test near‑equality patterns. “Randomize” gives quick starting points.</p>
  </footer>

  <script>
    // ---------- Utilities ----------
    function isPrime(n){
      if(n < 2) return false; if(n%2===0) return n===2; const r=Math.floor(Math.sqrt(n));
      for(let d=3; d<=r; d+=2){ if(n%d===0) return false; } return true;
    }

    function sumset(A,B,p){
      const S = new Array(p).fill(false);
      for(let i=0;i<p;i++) if(A[i]){
        for(let j=0;j<p;j++) if(B[j]){
          S[(i+j)%p] = true;
        }
      }
      return S;
    }

    function sizeOf(arr){ let c=0; for(const x of arr) if(x) c++; return c; }

    function makeIntervalFromMask(mask){
      // Make an interval (contiguous block on the circle) with the SAME size as mask
      const n = mask.length; const k = sizeOf(mask);
      if(k===0) return new Array(n).fill(false);
      const start = 0; // default start at 0 for simplicity; user can rotate by clicking
      const out = new Array(n).fill(false);
      for(let t=0;t<k;t++) out[(start+t)%n]=true; return out;
    }

    function randomMask(n, density=0.25){
      const arr = new Array(n).fill(false);
      for(let i=0;i<n;i++) if(Math.random()<density) arr[i]=true; if(sizeOf(arr)===0) arr[Math.floor(Math.random()*n)]=true; return arr;
    }

    // ---------- State ----------
    let p = 17;
    let A = new Array(p).fill(false);
    let B = new Array(p).fill(false);
    let active = 'A';

    const svg = document.getElementById('ring');
    const radiusOuter = 290, cx=350, cy=350;

    function render(){
      svg.innerHTML = '';
      // background ring
      const ring = document.createElementNS('http://www.w3.org/2000/svg','circle');
      ring.setAttribute('cx',cx); ring.setAttribute('cy',cy); ring.setAttribute('r',radiusOuter);
      ring.setAttribute('fill','none'); ring.setAttribute('stroke','#243157'); ring.setAttribute('stroke-width','3');
      svg.appendChild(ring);

      // Sumset (outer glow dots)
      const S = sumset(A,B,p);
      for(let i=0;i<p;i++) if(S[i]){
        const ang = -Math.PI/2 + 2*Math.PI*i/p;
        const r = radiusOuter;
        const x = cx + r*Math.cos(ang), y = cy + r*Math.sin(ang);
        const gdot = document.createElementNS('http://www.w3.org/2000/svg','circle');
        gdot.setAttribute('cx',x); gdot.setAttribute('cy',y); gdot.setAttribute('r',7);
        gdot.setAttribute('fill','#6ee7b7'); gdot.setAttribute('opacity','0.25');
        svg.appendChild(gdot);
      }

      // ticks and interactive nodes
      for(let i=0;i<p;i++){
        const ang = -Math.PI/2 + 2*Math.PI*i/p;
        const rTick = radiusOuter - 22;
        const xt = cx + rTick*Math.cos(ang), yt = cy + rTick*Math.sin(ang);
        const tick = document.createElementNS('http://www.w3.org/2000/svg','line');
        tick.setAttribute('x1',xt); tick.setAttribute('y1',yt);
        tick.setAttribute('x2', cx + (rTick-12)*Math.cos(ang));
        tick.setAttribute('y2', cy + (rTick-12)*Math.sin(ang));
        tick.setAttribute('stroke','#33467a'); tick.setAttribute('stroke-width','2');
        svg.appendChild(tick);

        const rA = radiusOuter - 56;
        const rB = radiusOuter - 86;
        const xa = cx + rA*Math.cos(ang), ya = cy + rA*Math.sin(ang);
        const xb = cx + rB*Math.cos(ang), yb = cy + rB*Math.sin(ang);

        const nodeA = document.createElementNS('http://www.w3.org/2000/svg','circle');
        nodeA.setAttribute('cx',xa); nodeA.setAttribute('cy',ya); nodeA.setAttribute('r',10);
        nodeA.setAttribute('fill', A[i] ? '#5cc7ff' : '#22305f');
        nodeA.setAttribute('stroke', active==='A' ? '#6cf' : '#2a3568'); nodeA.setAttribute('stroke-width','2');
        nodeA.style.cursor='pointer';
        nodeA.addEventListener('click',()=>{ if(active==='A'){ A[i]=!A[i]; update(); }});
        svg.appendChild(nodeA);

        const nodeB = document.createElementNS('http://www.w3.org/2000/svg','rect');
        nodeB.setAttribute('x',xb-9); nodeB.setAttribute('y',yb-9); nodeB.setAttribute('width',18); nodeB.setAttribute('height',18); nodeB.setAttribute('rx',4);
        nodeB.setAttribute('fill', B[i] ? '#ffb86c' : '#3a2b10');
        nodeB.setAttribute('stroke', active==='B' ? '#ffcf96' : '#47361a'); nodeB.setAttribute('stroke-width','2');
        nodeB.style.cursor='pointer';
        nodeB.addEventListener('click',()=>{ if(active==='B'){ B[i]=!B[i]; update(); }});
        svg.appendChild(nodeB);

        // labels every few points
        if(p<=23 || i%5===0){
          const rl = radiusOuter - 120; const xl = cx + rl*Math.cos(ang), yl = cy + rl*Math.sin(ang);
          const label = document.createElementNS('http://www.w3.org/2000/svg','text');
          label.setAttribute('x',xl); label.setAttribute('y',yl); label.setAttribute('fill','#9aa4c7');
          label.setAttribute('font-size','11'); label.setAttribute('text-anchor','middle'); label.setAttribute('dominant-baseline','middle');
          label.textContent = i.toString(); svg.appendChild(label);
        }
      }

      // center title
      const t = document.createElementNS('http://www.w3.org/2000/svg','text');
      t.setAttribute('x',cx); t.setAttribute('y',cy);
      t.setAttribute('fill','#9aa4c7'); t.setAttribute('font-size','18'); t.setAttribute('text-anchor','middle');
      t.textContent = `Z / ${p}Z`;
      svg.appendChild(t);

      // stats
      const sizeA = sizeOf(A), sizeB = sizeOf(B), sizeS = sizeOf(sumset(A,B,p));
      const lb = Math.min(p, sizeA + sizeB - 1);
      const gap = Math.max(0, sizeS - lb);
      document.getElementById('sizeA').textContent = sizeA;
      document.getElementById('sizeB').textContent = sizeB;
      document.getElementById('sizeS').textContent = sizeS;
      document.getElementById('lb').textContent = lb;
      const gapEl = document.getElementById('gap');
      gapEl.textContent = gap;
      const diag = document.getElementById('diagnosis');
      if(sizeA===0 || sizeB===0){ diag.textContent = 'Both sets must be nonempty.'; gapEl.className='big bad'; }
      else if(sizeS===lb){ diag.textContent = 'Tight! You hit the lower bound.'; gapEl.className='big ok'; confetti(svg); }
      else if(sizeS<lb){ diag.textContent = 'Numerical glitch? (Should not be below the bound.)'; gapEl.className='big bad'; }
      else{
        gapEl.className = gap<=2 ? 'big warn' : 'big bad';
        diag.textContent = 'Can you shrink |A+B| further? Try turning A or B into an interval.';
      }
    }

    function update(){ render(); }

    // Minimal confetti effect (SVG circles fading)
    function confetti(target){
      for(let k=0;k<16;k++){
        const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
        const r = radiusOuter*Math.random()*0.9; const ang = Math.random()*Math.PI*2;
        const x = 350 + r*Math.cos(ang), y = 350 + r*Math.sin(ang);
        c.setAttribute('cx',x); c.setAttribute('cy',y); c.setAttribute('r',Math.random()*3+1);
        c.setAttribute('fill', ['#6cf','#ffb86c','#6ee7b7'][k%3]); c.setAttribute('opacity','0.9');
        target.appendChild(c);
        setTimeout(()=>{ c.style.transition='opacity 600ms ease-out'; c.setAttribute('opacity','0'); setTimeout(()=>c.remove(),700); }, 0);
      }
    }

    // ---------- Controls ----------
    document.getElementById('pickA').addEventListener('click',()=>{
      active='A'; document.getElementById('pickA').classList.add('active'); document.getElementById('pickB').classList.remove('active'); update();
    });
    document.getElementById('pickB').addEventListener('click',()=>{
      active='B'; document.getElementById('pickB').classList.add('active'); document.getElementById('pickA').classList.remove('active'); update();
    });

    document.getElementById('applyP').addEventListener('click',()=>{
      const val = parseInt(document.getElementById('p').value,10);
      if(!isPrime(val)){
        alert('Please enter a prime p (≥ 5).'); return;
      }
      p = val; A = new Array(p).fill(false); B = new Array(p).fill(false); update();
    });

    document.getElementById('randomize').addEventListener('click',()=>{
      const dA = 0.15 + Math.random()*0.35; const dB = 0.15 + Math.random()*0.35;
      A = randomMask(p, dA); B = randomMask(p, dB); update();
    });

    document.getElementById('reset').addEventListener('click',()=>{
      A = new Array(p).fill(false); B = new Array(p).fill(false); update();
    });

    document.getElementById('makeAInterval').addEventListener('click',()=>{ A = makeIntervalFromMask(A); update(); });
    document.getElementById('makeBInterval').addEventListener('click',()=>{ B = makeIntervalFromMask(B); update(); });

    // initial state
    A[0]=true; B[0]=true; update();
  </script>
</body>
</html>
